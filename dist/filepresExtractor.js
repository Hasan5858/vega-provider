"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){var value;result.done?resolve(result.value):(value=result.value,value instanceof P?value:new P(function(resolve){resolve(value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})},__importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.filepresExtractor=filepresExtractor;const axios_1=__importDefault(require("axios")),headers_1=require("./headers");function filepresExtractor(link,signal){return __awaiter(this,void 0,void 0,function*(){try{const fileIdMatch=link.match(/\/file\/([a-zA-Z0-9]+)/);if(!fileIdMatch||!fileIdMatch[1])return[];const fileId=fileIdMatch[1],step1Response=yield axios_1.default.post("https://new5.filepress.today/api/file/downlaod/",{id:fileId,method:"cloudR2Downlaod",captchaValue:""},{headers:Object.assign(Object.assign({},headers_1.headers),{"Content-Type":"application/json",Origin:"https://new5.filepress.today",Referer:link,"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"}),signal:signal,timeout:15e3});if(!step1Response.data.status||!step1Response.data.data)return[];const downloadId=step1Response.data.data.downloadId,step2Response=yield axios_1.default.post("https://new5.filepress.today/api/file/downlaod2/",{id:downloadId,method:"cloudR2Downlaod",captchaValue:null},{headers:Object.assign(Object.assign({},headers_1.headers),{"Content-Type":"application/json",Origin:"https://new5.filepress.today",Referer:"https://new5.filepress.today/download/","User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"}),signal:signal,timeout:15e3});if(!step2Response.data.status||!step2Response.data.data)return[];const directDownloadUrl=step2Response.data.data;if(!directDownloadUrl||"string"!=typeof directDownloadUrl)return[];let quality="720";return directDownloadUrl.includes("1080")?quality="1080":directDownloadUrl.includes("480")?quality="480":directDownloadUrl.includes("360")&&(quality="360"),[{server:"FilePres",link:directDownloadUrl,type:"mp4",quality:quality}]}catch(error){return error.response,[]}})}