"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){var value;result.done?resolve(result.value):(value=result.value,value instanceof P?value:new P(function(resolve){resolve(value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0}),exports.getMeta=void 0;const headers={Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7","Cache-Control":"no-store","Accept-Language":"en-US,en;q=0.9",DNT:"1","sec-ch-ua":'"Not_A Brand";v="8", "Chromium";v="120", "Microsoft Edge";v="120"',"sec-ch-ua-mobile":"?0","sec-ch-ua-platform":'"Windows"',"Sec-Fetch-Dest":"document","Sec-Fetch-Mode":"navigate","Sec-Fetch-Site":"none","Sec-Fetch-User":"?1","Upgrade-Insecure-Requests":"1","User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36 Edg/131.0.0.0"},getMeta=_a=>__awaiter(void 0,[_a],void 0,function*({link:link,providerContext:providerContext}){var _b,_c,_d;try{const{axios:axios,cheerio:cheerio}=providerContext,baseUrl=link.split("/").slice(0,3).join("/"),response=yield axios.get(link,{headers:Object.assign(Object.assign({},headers),{Referer:baseUrl})}),$=cheerio.load(response.data),infoContainer=$(".entry-content, .post-inner, .movie-info"),title=$("h1.page-title").text().trim()||$("h1.entry-title").text().trim()||$("h1").text().trim(),infoParagraph=$(".entry-content p").first().text(),bodyText=$("body").text().toLowerCase(),hasSeriesIndicators=["season","episode","s0","e0","series","tv-show","web-series","season 2","season 3","s02","s03","e01","e02","e03","e04","e05","episodes","complete","all episodes","s19","s20","s21","s22","s23","s24","s25"].some(indicator=>title.toLowerCase().includes(indicator)||infoParagraph.toLowerCase().includes(indicator)||bodyText.includes(indicator)),hasMovieIndicators=["full movie","hindi movie","bollywood movie","hollywood movie","hdtc","bluray","web-dl","dvdrip","brrip","film","movie"].some(indicator=>title.toLowerCase().includes(indicator)||infoParagraph.toLowerCase().includes(indicator));let type="movie";hasSeriesIndicators&&!hasMovieIndicators?type="series":hasMovieIndicators&&(type="movie");const cleanTitle=title.split(/\[| \d+p| x\d+/)[0].trim(),showNameMatch=infoParagraph.match(/SHOW Name: (.+)/)||infoParagraph.match(/Name: (.+)/),finalTitle=showNameMatch&&showNameMatch[1]?showNameMatch[1].trim():cleanTitle,imdbMatch=(null===(_b=infoContainer.html())||void 0===_b?void 0:_b.match(/tt\d+/))||(null===(_c=$("a[href*='imdb.com/title/']").attr("href"))||void 0===_c?void 0:_c.match(/tt\d+/)),imdbId=imdbMatch?imdbMatch[0]:"";let image=infoContainer.find(".post-thumbnail img").attr("src")||infoContainer.find("img[src]").first().attr("src")||"";image.startsWith("//")?image="https:"+image:image.startsWith("/")&&(image=baseUrl+image);const synopsis=infoContainer.find("p").filter((i,el)=>{const text=$(el).text().trim();return text.length>50&&!text.includes("Download")&&!text.includes("Quality")}).first().text().trim()||"",links=[],dwdButtons=$(".dwd-button");if(dwdButtons.length>0){const allDownloadLinks=[];if(dwdButtons.each((i,btn)=>{const btnEl=$(btn),parentLink=btnEl.parent("a").attr("href"),text=btnEl.text().trim();if(parentLink&&!parentLink.includes("javascript:")&&!parentLink.includes("mailto:")){let serverType="Unknown";parentLink.includes("hubdrive")||parentLink.includes("hubcloud")?serverType="HubDrive":parentLink.includes("nexdrive")?serverType="NexDrive":parentLink.includes("gdflix")?serverType="GDFlix":parentLink.includes("filepress")?serverType="FilePress":parentLink.includes("gofile")&&(serverType="GoFile"),allDownloadLinks.push({title:`${serverType} - ${text}`,link:parentLink.startsWith("http")?parentLink:`${baseUrl}${parentLink}`,type:type,server:serverType})}}),allDownloadLinks.length>0){new Set(allDownloadLinks.map(link=>link.server));[{quality:"480p",servers:allDownloadLinks.slice(0,Math.min(2,allDownloadLinks.length))},{quality:"720p",servers:allDownloadLinks.slice(0,Math.min(3,allDownloadLinks.length))},{quality:"1080p",servers:allDownloadLinks.slice(0,Math.min(4,allDownloadLinks.length))},{quality:"4K",servers:allDownloadLinks.slice(0,Math.min(2,allDownloadLinks.length))}].forEach(option=>{var _a;option.servers.length>0&&links.push({title:`${option.quality} - ${option.servers.length} servers`,quality:option.quality,episodesLink:"series"===type&&(null===(_a=option.servers[0])||void 0===_a?void 0:_a.link)||"",directLinks:option.servers})})}}if(0===links.length){const qualitySections=$("h2, h3, h4").filter((i,el)=>{const text=$(el).text().toLowerCase();return text.includes("480p")||text.includes("720p")||text.includes("1080p")||text.includes("4k")||text.includes("hd")||text.includes("bluray")});if(qualitySections.length>0)qualitySections.each((i,section)=>{const $section=$(section),sectionText=$section.text(),qualityMatch=sectionText.match(/(\d+p|4k|hd|bluray)/i),quality=qualityMatch?qualityMatch[1]:"HD",allButtons=$section.nextUntil("h2, h3, h4").find("a[href]");if(allButtons.length>0){const fullTitle=`${quality} - ${sectionText.trim()}`;if("series"===type){const episodeButtons=allButtons.filter((i,btn)=>{const text=$(btn).text().toLowerCase();return text.includes("episode")||text.includes("episodes")}),episodesLink=episodeButtons.length>0?episodeButtons.first().attr("href")||"":allButtons.first().attr("href")||"";links.push({title:fullTitle,quality:quality,episodesLink:episodesLink,directLinks:[]})}else{const directLinks=[];allButtons.each((i,btn)=>{const btnEl=$(btn),link=btnEl.attr("href"),text=btnEl.text().trim();text.toLowerCase().includes("how to download")||text.toLowerCase().includes("tutorial")||text.toLowerCase().includes("guide")||(null==link?void 0:link.includes("how-to-download"))||(!(null==link?void 0:link.includes("movies4u.ps/"))||link.includes("download")||link.includes("file"))&&link&&!link.includes("javascript:")&&directLinks.push({title:text||"Download",link:link.startsWith("http")?link:`${baseUrl}${link}`,type:"movie"})}),directLinks.length&&links.push({title:fullTitle,quality:quality,episodesLink:"",directLinks:directLinks})}}});else{const allButtons=$("a[href]").filter((i,el)=>{const $el=$(el),href=$el.attr("href"),text=$el.text().toLowerCase();return!(!href||!(text.includes("download")||text.includes("watch")||text.includes("stream")||href.includes("hubcloud")||href.includes("nexdrive")||href.includes("gdflix")))});if(allButtons.length>0){const directLinks=[];allButtons.each((i,btn)=>{const btnEl=$(btn),link=btnEl.attr("href"),text=btnEl.text().trim();!link||link.includes("javascript:")||text.toLowerCase().includes("how to download")||link.includes("how-to-download")||directLinks.push({title:text||"Download",link:link.startsWith("http")?link:`${baseUrl}${link}`,type:type})}),directLinks.length&&links.push({title:"Downloads",quality:"HD",episodesLink:"series"===type&&(null===(_d=directLinks[0])||void 0===_d?void 0:_d.link)||"",directLinks:"movie"===type?directLinks:[]})}}}return{title:finalTitle,synopsis:synopsis,image:image,imdbId:imdbId,type:type,linkList:links}}catch(error){return{title:"",synopsis:"",image:"",imdbId:"",type:"movie",linkList:[]}}});exports.getMeta=getMeta;