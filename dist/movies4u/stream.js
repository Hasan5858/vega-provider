"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){var value;result.done?resolve(result.value):(value=result.value,value instanceof P?value:new P(function(resolve){resolve(value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0}),exports.getStream=getStream;const WORKER_URL="https://movies4u.steep-bread-3c84.workers.dev";function parseQuality(qualityStr){return qualityStr?qualityStr.includes("1080")||qualityStr.includes("4k")||qualityStr.includes("4K")?"1080":qualityStr.includes("2160")?"2160":qualityStr.includes("720")?"720":qualityStr.includes("480")?"480":qualityStr.includes("360")?"360":"720":"720"}function extractStream(url,extractors,signal,quality){return __awaiter(this,void 0,void 0,function*(){if(!url)return[];const parsedQuality=parseQuality(quality||"");if(url.includes(".mp4")||url.includes(".mkv")||url.includes(".avi"))return[{server:"Direct",link:url,type:"mp4",quality:parsedQuality}];if(url.includes("hubcloud")){const extracted=yield extractors.hubcloudExtracter(url,signal);return(null==extracted?void 0:extracted.map(s=>Object.assign(Object.assign({},s),{server:s.server||"HubCloud",quality:parsedQuality||s.quality})))||[]}if(url.includes("gdflix")){const extracted=yield extractors.gdFlixExtracter(url,signal);return(null==extracted?void 0:extracted.map(s=>Object.assign(Object.assign({},s),{server:s.server||"GDFlix",quality:parsedQuality||s.quality})))||[]}if(url.includes("gofile")){const extracted=yield extractors.gofileExtracter(url);return extracted&&extracted.link?[{server:"GoFile",link:extracted.link,type:"mp4",quality:parsedQuality}]:[]}if(url.includes("fastdl")){const extracted=yield extractors.fastdlExtractor(url,signal);return(null==extracted?void 0:extracted.map(s=>Object.assign(Object.assign({},s),{server:s.server||"FastDL",quality:parsedQuality||s.quality})))||[]}if(url.includes("vcloud")){const extracted=yield extractors.vcloudExtractor(url,signal);return(null==extracted?void 0:extracted.map(s=>Object.assign(Object.assign({},s),{server:s.server||"VCloud",quality:parsedQuality||s.quality})))||[]}if(url.includes("filepress")){const extracted=yield extractors.filepresExtractor(url,signal);return(null==extracted?void 0:extracted.map(s=>Object.assign(Object.assign({},s),{server:s.server||"FilePres",quality:parsedQuality||s.quality})))||[]}return url.includes("hubdrive")?[{server:"HubDrive",link:url,type:"mp4",quality:parsedQuality}]:[]})}function getStream(_a){return __awaiter(this,arguments,void 0,function*({link:link,type:type,signal:signal,providerContext:providerContext}){const{axios:axios,extractors:extractors}=providerContext;try{const{data:data}=yield axios.get(WORKER_URL,{params:{action:"stream",link:link},signal:signal,timeout:3e4});if(!data.success||!Array.isArray(data.streams))return[];const allStreams=[];for(const streamLink of data.streams)try{const url=streamLink.link,qualityFromWorker=(streamLink.server,streamLink.quality||"720p");if(!url||url.includes("how-to-download")||url.includes("tutorial")||url.includes("gdtot"))continue;if(url.includes("nexdrive")){const extracted=yield extractors.nexdriveExtractor(url,signal);if(extracted&&extracted.length>0)for(const serviceLink of extracted)try{serviceLink.server;const finalStreams=yield extractStream(serviceLink.link,extractors,signal,qualityFromWorker);finalStreams&&finalStreams.length>0?allStreams.push(...finalStreams):allStreams.push(Object.assign(Object.assign({},serviceLink),{quality:parseQuality(qualityFromWorker)}))}catch(err){allStreams.push(Object.assign(Object.assign({},serviceLink),{quality:parseQuality(qualityFromWorker)}))}}else{const extracted=yield extractStream(url,extractors,signal,qualityFromWorker);extracted&&extracted.length>0&&allStreams.push(...extracted)}}catch(extractorError){}return allStreams}catch(error){return[]}})}